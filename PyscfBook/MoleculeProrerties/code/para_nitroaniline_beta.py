# ============================================================
# para_nitroaniline_beta.py
# Перша гіперполяризовність (β) для пара-нітроаніліну
# ============================================================

from pyscf import gto, scf, dft
from pyscf.prop import polarizability
import numpy as np

# pара-нітроанілін: H2N-C6H4-NO2
# Донорно-акцепторна система з великою β
mol = gto.M(
    atom="""
    N   -3.4523   0.0000   0.0000
    C   -2.0843   0.0000   0.0000
    C   -1.3695   1.2042   0.0000
    C    0.0185   1.2042   0.0000
    C    0.7333   0.0000   0.0000
    C    0.0185  -1.2042   0.0000
    C   -1.3695  -1.2042   0.0000
    N    2.1813   0.0000   0.0000
    O    2.7961   1.0721   0.0000
    O    2.7961  -1.0721   0.0000
    H   -1.9145   2.1442   0.0000
    H    0.5635   2.1442   0.0000
    H    0.5635  -2.1442   0.0000
    H   -1.9145  -2.1442   0.0000
    H   -3.9223   0.8105   0.0000
    H   -3.9223  -0.8105   0.0000
    """,
    basis="6-31+g*",
    unit="angstrom",
)

print("Гіперполяризовність пара-нітроаніліну (pNA)")
print("=" * 60)
print("\nМолекулярна структура: H₂N-C₆H₄-NO₂")
print("Донор (NH₂) ←→ Акцептор (NO₂)")

# DFT розрахунок (B3LYP краще для гіперполяризовностей)
print("\nSCF розрахунок (B3LYP/6-31+G*)...")
mf = dft.RKS(mol)
mf.xc = "b3lyp"
mf.verbose = 0
mf.kernel()

# Дипольний момент
dip = mf.dip_moment(unit='Debye')
dip_mag = np.linalg.norm(dip)
print(f"\nДипольний момент: |μ| = {dip_mag:.3f} D")
print(f"  Напрямок μ: ({dip[0]:.3f}, {dip[1]:.3f}, {dip[2]:.3f})")

# Одиничний вектор вздовж μ
mu_hat = dip / dip_mag

# Статична поляризовність
print("\nОбчислення поляризовності...")
pol = polarizability.rks.Polarizability(mf)
alpha = pol.polarizability()

alpha_mean = np.trace(alpha) / 3
print(f"Середня поляризовність: ᾱ = {alpha_mean:.2f} au³")

# Перша гіперполяризовність β
# Це складний розрахунок, потребує похідних третього порядку
print("\nОбчислення гіперполяризовності β...")
print("(Це може зайняти кілька хвилин)")

# Використовуємо скінченні різниці з малим полем
beta_components = pol.hyperpolarizability()

# β - тензор рангу 3: β_ijk
# Для статичної β(0;0,0) маємо 27 компонент
# Найважливіша: β_zzz вздовж довгої осі молекули

print("\nОсновні компоненти β (au):")
print(f"  β_xxx = {beta_components[0,0,0]:.1f}")
print(f"  β_yyy = {beta_components[1,1,1]:.1f}")
print(f"  β_zzz = {beta_components[2,2,2]:.1f}")

# Проекція β на напрямок дипольного моменту
# β_vec = Σ_ijk β_ijk μ̂_j μ̂_k
beta_vec = 0
for i in range(3):
    for j in range(3):
        for k in range(3):
            beta_vec += beta_components[i,j,k] * mu_hat[j] * mu_hat[k]

print(f"\nВекторна гіперполяризовність:")
print(f"  β_vec = {beta_vec:.1f} au")
print(f"        = {beta_vec * 8.639:.1f} × 10⁻³³ esu")

print("\n" + "=" * 60)
print("Фізична інтерпретація:")
print("- Велике значення β_zzz вздовж молекулярної осі")
print("- Переніс заряду NH₂ → NO₂ при збудженні")
print("- Використовується для генерації другої гармоніки")
print("- pNA - стандартна молекула для нелінійної оптики")

