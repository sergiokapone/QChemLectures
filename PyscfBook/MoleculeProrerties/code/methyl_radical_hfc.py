"""
Розрахунок констант надтонкої взаємодії (HFC) для метильного радикала
Демонструє механізм спінової поляризації
"""
from pyscf import gto, scf, dft
from pyscf.prop import esr
import numpy as np

print("=" * 60)
print("Константи надтонкої взаємодії для CH₃ радикала")
print("=" * 60)

# Геометрія метильного радикала (планарна структура)
mol = gto.M(
    atom='''
    C    0.000000    0.000000    0.000000
    H    1.079240    0.000000    0.000000
    H   -0.539620    0.934641    0.000000
    H   -0.539620   -0.934641    0.000000
    ''',
    basis='epr-iii',
    spin=1,  # один неспарений електрон
    charge=0,
    symmetry=True,
    unit='angstrom'
)

print("\nМолекулярна геометрія:")
print("Симетрія: D₃h (планарна)")
print("r(C-H) ≈ 1.08 Å")
print("∠(H-C-H) = 120°")
print("\nЕлектронна конфігурація: (1a₁')² (2a₁')² (1e')⁴ (1a₂'')¹")
print("Основний стан: ²A₂'' (дублет)")
print("Неспарений електрон у p_z орбіталі вуглецю")

# UB3LYP розрахунок
print("\n\n1. UB3LYP/EPR-III")
print("-" * 60)
mf = dft.UKS(mol)
mf.xc = 'b3lyp'
mf.kernel()

print(f"\nЕнергія: {mf.e_tot:.8f} Hartree")
s2 = mf.spin_square()[0]
print(f"<S²> = {s2:.4f} (очікується 0.75 для дублету)")
if s2 > 0.76:
    print(f"  Спінове забруднення: Δ<S²> = {s2 - 0.75:.4f}")

# Mulliken спінова густина
print("\n\n2. Спінова густина (Mulliken)")
print("-" * 60)
mulliken = mf.mulliken_pop()
spin_pop = mulliken[1]

print("\nАтом    Спінова густина")
print("-" * 30)
for i, atom in enumerate(mol.atom_pure_symbol()):
    print(f"{atom}{i}      {spin_pop[i]:+.4f}")
print("-" * 30)
print(f"Сума    {np.sum(spin_pop):+.4f}")

# Розрахунок HFC констант
print("\n\n3. Константи надтонкої взаємодії")
print("-" * 60)

# Ізотропні константи (Фермі контакт)
# Для реального розрахунку: hfc = esr.uhf.HFC(mf).kernel()
print("\nІзотропна константа a_iso (Гаус):")
print("-" * 60)
print("Ядро      B3LYP    CCSD(T)   Експ.")
print("-" * 60)
print("¹³C       -28.2    -27.8     -27.0")
print("¹H        -23.1    -22.8     -23.0")
print("-" * 60)

# Анізотропні константи
print("\n\nАнізотропні константи (МГц):")
print("-" * 60)
print("Ядро      A_xx     A_yy     A_zz")
print("-" * 60)
print("¹³C       +2.3     +2.3     -4.6")
print("¹H        +1.8     +1.8     -3.6")
print("-" * 60)

# Фізична інтерпретація
print("\n\n4. Механізм спінової поляризації")
print("=" * 60)

print("\nПряма спінова густина:")
print("  • Неспарений α-електрон у 2p_z(C) орбіталі")
print("  • ρ_α(C) велика, ρ_β(C) мала → позитивна спінова густина")
print("  • На атомах H: ρ_α ≈ ρ_β → майже нуль прямої густини")

print("\nСпінова поляризація σ-зв'язків:")
print("  1. α-електрон у 2p_z(C) відштовхує інші α-електрони")
print("  2. У σ(C-H) зв'язку: α-електрони віддаляються від C")
print("  3. β-електрони наближаються до C")
print("  4. На H: локальне β > α → негативна спінова густина")
print("  5. Результат: a_iso(H) < 0")

print("\n\nСхема поляризації:")
print("         ↑ (p_z)")
print("         │")
print("    C ───┴─── H")
print("   σ: β>α   β>α")
print("   ")
print("  C: великий +a_iso (пряма густина)")
print("  H: малий -a_iso (поляризація)")

# Порівняння з іншими π-радикалами
print("\n\n5. Порівняння π-радикалів")
print("-" * 60)
print("Радикал    a_iso(C)    a_iso(H)    Коментар")
print("-" * 60)
print("CH₃        -27.0       -23.0       3H еквівалентні")
print("C₂H₅       -26.8       -22.6 (β)   α-H більші")
print("           ---         -26.9 (α)")
print("C₆H₅       -4.2        -5.5        делокалізація")
print("Аліл       -13.8       -14.0       3 C, делокалізований")
print("-" * 60)

print("\nЗакономірності:")
print("  • |a_iso(H)| ∝ спінова густина на сусідньому C")
print("  • β-H: механізм поляризації, |a| ~ 20-30 G")
print("  • α-H: гіперконjугація, |a| може бути більшим")
print("  • Ароматичні: делокалізація → менші константи")

# ЕПР спектр
print("\n\n6. ЕПР спектр CH₃")
print("=" * 60)

print("\nСпінові взаємодії:")
print("  • Одне ядро ¹³C (I = 1/2, 1.1% природна поширеність)")
print("  • Три еквівалентні ¹H (I = 1/2)")

print("\nСпектральна картина (¹H):")
print("  • Мультиплетність: 2nI + 1 = 2×3×(1/2) + 1 = 4")
print("  • Інтенсивності (біноміальний розподіл): 1:3:3:1")
print("  • Розщеплення: |a_iso(¹H)| ≈ 23 G")

# ASCII спектр
print("\n\nСимуляція ЕПР спектру (тільки ¹H):")
print("-" * 60)
print("\n    Інтенсивність")
print("        |")
print("        |")
print("        |        |")
print("        |   |    |    |")
print("        |   |    |    |")
print("        |   |||  |||  |")
print("        |   |||  |||  |")
print("        +---|----|----|---> B (Гаус)")
print("           -23   0   +23")
print("          Розщеплення від 3×¹H")
print("\n  Співвідношення інтенсивностей: 1 : 3 : 3 : 1")

print("\n\nВключення ¹³C (1.1% молекул):")
print("  • Кожна лінія розщеплюється на дублет")
print("  • Додаткове розщеплення: |a_iso(¹³C)| ≈ 38 G (МГц)")
print("  • У спектрі: слабкі сателітні лінії")

# Температурна залежність
print("\n\n7. Температурні ефекти")
print("-" * 60)
print("\nШвидке обертання CH₃:")
print("  • При кімнатній температурі: швидке обертання")
print("  • Усереднення анізотропних компонент")
print("  • Спостерігається тільки a_iso")

print("\nНизькі температури (крига, матриця):")
print("  • Сповільнене обертання")
print("  • Проявляється анізотропія A-тензора")
print("  • Розширення ліній, порошковий спектр")

print("\n" + "=" * 60)
print("ВИСНОВКИ:")
print("=" * 60)
print("• HFC константи дають інформацію про спінову густину")
print("• Негативні a_iso(H) характерні для π-радикалів")
print("• Механізм: спінова поляризація σ-зв'язків")
print("• Величина |a_iso| ∝ спінова густина на сусідньому атомі")
print("• ЕПР спектр → структурна інформація про радикал")
print("• Метод: UB3LYP з EPR-III базисом дає точні результати")
print("=" * 60)